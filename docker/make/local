# use our wasm-friendly TBB, not Stan's vendored version
TBB_INTERFACE_NEW=1
# TBB_INC=$(TBB_FROM_STEP_3)/include/ # CHANGE THIS
TBB_INC=/app/oneTBB/include/
# TBB_LIB=$(TBB_BUILD_FOLDER_FROM_STEP_4) # CHANGE THIS
TBB_LIB=/app/oneTBB/build/clang_19.0_cxx11_32_relwithdebinfo/
LDFLAGS_TBB ?= -Wl,-L,"$(TBB_LIB)"
LDLIBS_TBB ?= -ltbb
# Functions we want. Can add more, with a prepended _, from tinystan.h
EXPORTS=_malloc,_free,_tinystan_api_version,_tinystan_create_model,_tinystan_destroy_error,_tinystan_destroy_model,_tinystan_get_error_message,_tinystan_get_error_type,_tinystan_model_num_free_params,_tinystan_model_param_names,_tinystan_sample,_tinystan_separator_char,_tinystan_stan_version
CXXFLAGS+=-fwasm-exceptions # could also uses -fexceptions which is more compatible, but slower
CXXFLAGS+=-sEXIT_RUNTIME=1 -sALLOW_MEMORY_GROWTH=1
CXXFLAGS+=-sEXPORTED_FUNCTIONS=$(EXPORTS) -sEXPORTED_RUNTIME_METHODS=stringToUTF8,getValue,UTF8ToString,lengthBytesUTF8
CXXFLAGS+=-sMODULARIZE -sEXPORT_NAME=createModule -sEXPORT_ES6 -sENVIRONMENT=web